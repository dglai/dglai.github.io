<head>
    <!-- meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Library for deep learning on graphs">
    <meta name="keywords" content="Software, Machine Learning, Deep Learning, Neural Network, Graph">
    <meta name="author" content="Themeix">

    <!-- Site Title -->
    <title>Deep Graph Library</title>

    <!-- favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/dgl-favicon.png">

    <!-- IView CSS -->
    <link rel="stylesheet" href="//unpkg.com/iview/dist/styles/iview.css">

    <!-- Bootstrap CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font-Awesome CSS -->
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="/assets/css/googlefont.css" rel="stylesheet"> 

    <!-- Animate CSS -->
    <link rel="stylesheet" href="/assets/css/animate.min.css">

    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
    <!--<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">-->

    <!-- Mean Menu CSS -->
    <link rel="stylesheet" href="/assets/css/meanmenu.min.css">

    <!-- Main Stylesheet -->
    <link href="/assets/css/style.css" rel="stylesheet">

    <!-- Responsive CSS -->
    <link href="/assets/css/responsive.css" rel="stylesheet">

    <!-- Minima CSS -->
    <link href="/assets/main.css" rel="stylesheet">

    <!-- Rouge Highlighter CSS -->
    <link href="/assets/css/syntax.css" rel="stylesheet">

    <link type="application/atom+xml" rel="alternate" href="https://www.dgl.ai/feed.xml" title="Deep Graph Library" />

    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132455605-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132455605-1');
</script>

    
</head>
  
<body>
    <!-- Preloader starts-->
    <div class="preloader">
        <div class="loading-center">
            <div class="loading-center-absolute">
                <div class="object object_one"></div>
                <div class="object object_two"></div>
                <div class="object object_three"></div>
            </div>
        </div>
    </div>
    <!-- Preloader ends -->
    <!-- Start Header -->
    <header>
      <!-- Start Mainmenu -->
<div class="menu-area navbar-fixed-top ">
    <div class="container">
        <div class="row">
            <div class="mainmenu-wrapper">
                <!-- Start Header Logo -->
                <div class="col-xs-12 col-md-3">
                    <div class="header-logo">
                        <a href="https://www.dgl.ai"><img src="/assets/images/logo.png" alt="logo"></a>
                    </div>
                </div>
                <!-- End Header Logo -->
                <!-- Start Navigation -->
                <div class="col-xs-12 col-md-9">
                    <div class="mainmenu">
                        <div class="navbar navbar-right">
                            <div class="navbar-header visible-xs">
                                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>
                            <div class="collapse navbar-collapse top-menu">

                           <!--  Static Dropdown Menu 

                                <nav>
                                    <ul class="nav navbar-nav">
                                        <li class="active"><a href="https://www.dgl.ai">Home<span>Get everything</span></a>
                                           <ul class="dropdown">
                                               <li><a href="index.html">Home Version 1</a></li>
                                               <li><a href="index-2.html">Home Version 2</a></li>
                                           </ul>                                                
                                        </li>
                                        <li><a href="about-us.html">About<span>Know about us</span></a></li>                                
                                        <li><a href="questions.html">Questions<span>Ask Your Question</span></a>
                                            <ul class="dropdown">
                                                <li>
                                                    <a href="questions.html"> <span><i class="fa fa-question-circle"></i></span>All Questions</a>
                                                </li>                                                       
                                                <li><a href="ask-question.html"><span><i class="fa  fa-question-circle-o"></i></span>Ask Questions</a></li>
                                                <li><a href="answers.html"><span><i class="fa fa-reply-all"></i></span>Answers</a></li>
                                                <li><a href="login.html"><span><i class="fa fa-sign-in"></i></span>Login</a></li>
                                                <li><a href="register.html"><span><i class="fa fa-registered"></i></span>Register</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="#">Pages<span>See All Pages</span></a>
                                           <ul class="dropdown">
                                               <li><a href="index-2.html">Home 2</a></li>
                                               <li><a href="blog.html">Blog</a></li>
                                               <li><a href="blog-details.html">Blog Details</a></li>
                                               <li><a href="questions.html">Questions</a></li>
                                               <li><a href="answers.html">Answers</a></li>
                                               <li><a href="updates.html">Updates</a></li>
                                               <li><a href="contact.html">Contact</a></li>
                                               <li><a href="left-sidebar.html">Left Sidebar</a></li>
                                               <li><a href="right-sidebar.html">Right Sidebar</a></li>
                                               <li><a href="login.html">login</a></li>
                                               <li><a href="register.html">Register</a></li>
                                               <li><a href="404.html">404</a></li>
                                           </ul>
                                        </li>
                                        <li><a href="blog.html">Blog<span>All Blog Posts</span></a></li>
                                        <li><a href="updates.html">Updates<span>Latest releases</span></a></li>
                                        <li><a href="contact.html">Contact<span>Let us contact</span></a></li>
                                    </ul>
                                </nav> 

                                End Static Dropdown Menu -->

                                <nav>
                                    <ul class="nav navbar-nav">
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="/pages/about.html">about
                                          <!--<span>About DGL</span>-->
                                        </a>
                                     </li>
                                    
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="/pages/start.html">Get Started
                                          <!--<span>Install</span>-->
                                        </a>
                                     </li>
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="https://docs.dgl.ai/tutorials/blitz/index.html">Tutorials
                                        </a>
                                     </li>
                                     <li>
                                        <a href="/pages/index.html">Blogs
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://docs.dgl.ai">Docs
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://discuss.dgl.ai">Forum
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://github.com/dmlc/dgl">GitHub
                                        </a>
                                     </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Navigation -->
            </div>
        </div>
    </div>
</div>
<!-- End Mainmenu -->
<!-- Start Mobile Menu Area -->
<div class="col-xs-12 visible-xs">
    <div class="mobile-menu">
        <nav>
            <ul>
                <li><a href="/index.html">Home</a></li>
                
                
                
                
                 <li>
                    <a href="/pages/about.html">about
                    </a>
                 </li>
                
                
                
                
                
                 <li>
                    <a href="/pages/start.html">Get Started
                    </a>
                 </li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <!--
                <li><a href="#">Questions</a>
                    <ul>
                        <li><a href="questions.html"> Questions</a></li>
                        <li><a href="ask-question.html">Ask Questions</a></li>
                        <li><a href="answers.html">Answers</a></li>
                        <li><a href="login.html">Login</a></li>
                        <li><a href="register.html">Register</a></li>                               
                    </ul>
                </li>
                <li><a href="#">Pages</a>
                    <ul>
                       <li><a href="blog.html">Blog</a></li>
                       <li><a href="blog-details.html">Blog Details</a></li>
                       <li><a href="questions.html">Questions</a></li>
                       <li><a href="answers.html">Answers</a></li>
                       <li><a href="updates.html">Updates</a></li>
                       <li><a href="contact.html">Contact</a></li>
                       <li><a href="left-sidebar.html">Left Sidebar</a></li>
                       <li><a href="right-sidebar.html">Right Sidebar</a></li>
                       <li><a href="login.html">login</a></li>
                       <li><a href="register.html">Register</a></li>
                       <li><a href="404.html">404</a></li>                          
                    </ul>
                </li>                       
                -->
                <li><a href="https://docs.dgl.ai/tutorials/blitz/index.html">Tutorials</a></li>
                <li><a href="/pages/index.html">Blogs</a></li>
                <li><a href="https://docs.dgl.ai">Docs</a></li>
                <li><a href="https://discuss.dgl.ai">Forum</a></li>
                <li><a href="https://github.com/dmlc/dgl">GitHub</a></li>
            </ul>
        </nav>
    </div>
</div>
<!-- End MObile Menu Area

   </header>
    <!-- End Header -->
<!-- Start Page Banner Area -->
<div class="page-banner-area">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="page-title">
          <h2>Blog Details</h2>
          <span class="sub-title"><a href="https://www.dgl.ai">Home</a> / Blog Details</span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Pages Banner Area -->

<!-- Start Blog Area -->
<section class="blog-area themeix-ptb">
  <div class="container">
    <div class="row">
      <!-- Start Blog Content -->
      <div class="col-md-12">
        <div class="blog-wrapper">

          <div class="single-blog-details">
            <div class="blog-img">
              <img src="/assets/images/posts/2022-07-25-release/update-image.jpg" alt="blog">
            </div>
            <div class="blog-content-desc">
              <h4 class="themeix-blog-h">v0.9 Release Highlights</h4>
              <p><p>Six years after the first Graph Convolutional Networks paper, researchers are
actively investigating more advanced GNN architecture or training methodology.
As the developer team of DGL, we closely watch those new research trends and
release features to facilitate them. Here, we highlighted some of the new
functionalities of the recent v0.9 release.</p>

<h2 id="combining-graph-analytics-with-gnns-using-cugraphdgl">Combining Graph Analytics with GNNs using cuGraph+DGL</h2>

<p>Graph neural networks (GNNs) are capable of combining the feature and
structural information of graph data. Its power can be further extended when
synergistically combined with techniques of graph analytics, such as feature
augmentation.</p>

<p>Graph analytics has been widely used for characterising graph structures, e.g.,
identifying important nodes, leading to interesting feature augmentation
methods. To exploit the synergy, we would want a fast and scalable graph
analytics engine. NVidia’s <a href="https://github.com/rapidsai/cugraph">RAPIDS cuGraph
library</a> provides a collection of GPU
accelerated algorithms for graph analytics, such as centrality computation and
community detection. According to this
<a href="https://docs.rapids.ai/api/cugraph/stable/basics/cugraph_intro.html">documentation</a>,
<em>“the latest NVIDIA GPUs (RAPIDS supports Pascal and later GPU architectures)
make graph analytics 1000x faster on average over NetworkX”</em>.</p>

<p>With collaboration with NVidia’s engineers, DGL v0.9 now allows conversion
between a DGLGraph object and a cuGraph graph object with two APIs <code class="highlighter-rouge">to_cugraph</code>
and <code class="highlighter-rouge">from_cugraph</code>, making it possible for DGL users to access efficient graph
analytics implementations in cuGraph.</p>

<h3 id="installation">Installation</h3>

<p>To install cuGraph with PyTorch and DGL, we recommend following the practice
below. Mamba is a multi-threaded version of conda.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>conda install mamba -n base -c conda-forge

mamba create -n dgl_and_cugraph -c dglteam -c rapidsai-nightly -c nvidia -c pytorch -c conda-forge <span class="se">\</span>
    cugraph pytorch torchvision torchaudio <span class="nv">cudatoolkit</span><span class="o">=</span>11.3 dgl-cuda11.3 tqdm

conda activate dgl_and_cugraph
</code></pre>
</div>

<h3 id="feature-initialization-via-cugraph">Feature Initialization via cuGraph</h3>

<p>We showcase an example of node feature initialization using the graph analytics
algorithms provided by cuGraph. Here, we consider two options:</p>
<ul>
  <li><a href="https://docs.rapids.ai/api/cugraph/stable/api_docs/api/cugraph.louvain.html">Louvain algorithm</a> that detects the community membership of each node based on
modularity optimization.</li>
  <li><a href="https://docs.rapids.ai/api/cugraph/stable/api_docs/api/cugraph.core_number.html#cugraph.core_number">Core number algorithm</a> that calculates the maximal <a href="https://en.wikipedia.org/wiki/Degeneracy_(graph_theory)">k-core</a> subgraph each node
belongs to. A k-core of a graph is a maximal subgraph that contains nodes of
degree k or more.</li>
</ul>

<p>The two algorithms capture different structural characteristics of a node.
Louvain groups nodes with close spatial distance with each other, while nodes
with the same core numbers are more structurally similar with each other. The
figures below illustrate the node coloring produced by Louvain communities and
core numbers on <a href="https://en.wikipedia.org/wiki/Zachary%27s_karate_club">Zachary’s Karate Club Network</a>.</p>

<p><img src="/assets/images/posts/2022-07-25-release/node_coloring.png" alt="node_coloring" width="800x" class="aligncenter" /></p>

<p>cuGraph offers efficient GPU implementations of these two algorithms. To call
them, we convert a <code class="highlighter-rouge">dgl.DGLGraph</code> to a <code class="highlighter-rouge">cugraph.Graph</code> using the <code class="highlighter-rouge">to_cugraph</code>
API.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cugraph</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">louvain</span><span class="p">(</span><span class="n">dgl_g</span><span class="p">):</span>
    <span class="n">cugraph_g</span> <span class="o">=</span> <span class="n">dgl_g</span><span class="o">.</span><span class="n">to_cugraph</span><span class="p">()</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cugraph</span><span class="o">.</span><span class="n">louvain</span><span class="p">(</span><span class="n">cugraph_g</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c"># revert the node ID renumbering by cugraph</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cugraph_g</span><span class="o">.</span><span class="n">unrenumber</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">'vertex'</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s">'vertex'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dlpack</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'partition'</span><span class="p">]</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">core_number</span><span class="p">(</span><span class="n">dgl_g</span><span class="p">):</span>
    <span class="n">cugraph_g</span> <span class="o">=</span> <span class="n">dgl_g</span><span class="o">.</span><span class="n">to_cugraph</span><span class="p">()</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cugraph</span><span class="o">.</span><span class="n">core_number</span><span class="p">(</span><span class="n">cugraph_g</span><span class="p">)</span>
    <span class="c"># revert the node ID renumbering by cugraph</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cugraph_g</span><span class="o">.</span><span class="n">unrenumber</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">'vertex'</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s">'vertex'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dlpack</span><span class="o">.</span><span class="n">from_dlpack</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'core_number'</span><span class="p">]</span><span class="o">.</span><span class="n">to_dlpack</span><span class="p">())</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>
</code></pre>
</div>

<h3 id="training-gnn-via-dgl">Training GNN via DGL</h3>

<p>We then use the above functions to prepare node features for the ogbn-arxiv
dataset. Note that since both algorithms calculate structural categories, we
convert them to one-hot encoding and concatenate them as the initial node
features.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dgl.transforms</span> <span class="kn">as</span> <span class="nn">T</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="kn">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="kn">as</span> <span class="nn">F</span>

<span class="kn">from</span> <span class="nn">dgl.nn</span> <span class="kn">import</span> <span class="n">SAGEConv</span>
<span class="kn">from</span> <span class="nn">ogb.nodeproppred</span> <span class="kn">import</span> <span class="n">DglNodePropPredDataset</span><span class="p">,</span> <span class="n">Evaluator</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s">'cuda'</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">DglNodePropPredDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'ogbn-arxiv'</span><span class="p">)</span>
<span class="n">g</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">T</span><span class="o">.</span><span class="n">AddReverse</span><span class="p">(),</span>
    <span class="n">T</span><span class="o">.</span><span class="n">AddSelfLoop</span><span class="p">(),</span>
    <span class="n">T</span><span class="o">.</span><span class="n">ToSimple</span><span class="p">()</span>
<span class="p">])</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="nb">int</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">feat1</span> <span class="o">=</span> <span class="n">louvain</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">feat2</span> <span class="o">=</span> <span class="n">core_number</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="c"># convert to one-hot</span>
<span class="n">feat1</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">feat1</span><span class="p">,</span> <span class="n">feat1</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">feat2</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">feat2</span><span class="p">,</span> <span class="n">feat2</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c"># concat feat1 and feat2</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">feat1</span><span class="p">,</span> <span class="n">feat2</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">float</span><span class="p">()</span>
</code></pre>
</div>

<p>We then train a simple three layer GraphSAGE model (see complete training code
<a href="https://gist.github.com/jermainewang/f316587084f73e7dd060fe203417f42a">here</a>).
With the help of node features initialized by graph analytics algorithms, we
are able to achieve an accuracy of about 0.6 on the test set using pure
structural information, which even outperforms an MLP model using the original
input node features. With the new DGL release, we are looking forward to seeing
more innovation on GNNs combined with graph analytics.</p>

<h2 id="fp16--mixed-precision-support">FP16 &amp; Mixed Precision Support</h2>

<p>DGL v0.9 is now fully compatible with the <a href="https://pytorch.org/docs/stable/amp.html">PyTorch Automatic Mixed Precision
(AMP) package</a> for mixed precision training, thus saving both training time and
GPU memory consumption.</p>

<p>By wrapping the forward pass with torch.cuda.amp.autocast(), PyTorch
automatically selects the appropriate data type for each op and tensor. Half
precision tensors are memory efficient, most operators on half precision
tensors are faster as they leverage GPU tensorcores.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="kn">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">torch.cuda.amp</span> <span class="kn">import</span> <span class="n">autocast</span>

<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">feat</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">autocast</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">logit</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">feat</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logit</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">label</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">loss</span>
</code></pre>
</div>

<p>Small gradients in <code class="highlighter-rouge">float16</code> format have underflow problems (flush to zero).
PyTorch AMP provides a <code class="highlighter-rouge">GradScaler</code> module to address this issue. It multiplies
the loss by a factor and invokes backward pass on the scaled loss to prevent
the underflow problem. It then unscales the computed gradients before the
optimizer updates the parameters. The scale factor is determined automatically.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">torch.cuda.amp</span> <span class="kn">import</span> <span class="n">GradScaler</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">GradScaler</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">):</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</code></pre>
</div>

<p>Putting everything together, we have the example below.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="kn">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">dgl.data</span> <span class="kn">import</span> <span class="n">RedditDataset</span>
<span class="kn">from</span> <span class="nn">dgl.nn</span> <span class="kn">import</span> <span class="n">GATConv</span>
<span class="kn">from</span> <span class="nn">dgl.transforms</span> <span class="kn">import</span> <span class="n">AddSelfLoop</span>

<span class="k">class</span> <span class="nc">GAT</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_feats</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">num_hidden</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">num_heads</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">GATConv</span><span class="p">(</span><span class="n">in_feats</span><span class="p">,</span> <span class="n">num_hidden</span><span class="p">,</span> <span class="n">num_heads</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">elu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">GATConv</span><span class="p">(</span><span class="n">num_hidden</span> <span class="o">*</span> <span class="n">num_heads</span><span class="p">,</span> <span class="n">num_hidden</span><span class="p">,</span> <span class="n">num_heads</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s">'cuda'</span><span class="p">)</span>

<span class="n">transform</span> <span class="o">=</span> <span class="n">AddSelfLoop</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">RedditDataset</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="nb">int</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">train_mask</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s">'train_mask'</span><span class="p">]</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s">'feat'</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s">'label'</span><span class="p">]</span>
<span class="n">in_feats</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">GAT</span><span class="p">(</span><span class="n">in_feats</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">num_classes</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">forward</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">feat</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">train_mask</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">backward</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
</code></pre>
</div>

<p>Training GNNs using low precision or mixed precision is still an active
research topic. We hope the new v0.9 release will facilitate more research on
this topic. Check out the
<a href="https://docs.dgl.ai/guide/mixed_precision.html">documentation</a> to know more.</p>

<h2 id="dgl-go-update-model-inference-and-graph-prediction">DGL-Go Update: Model Inference and Graph Prediction</h2>

<p>DGL-Go now supports training GNNs for graph property prediction tasks. It
includes two popular GNN models – Graph Isomorphism Network (GIN) and Principal
Neighborhood Aggregation (PNA). For example, to train a GIN model on the
ogbg-molpcba dataset, first generate a YAML configuration file using command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>dgl configure graphpred --data ogbg-molpcba --model gin
</code></pre>
</div>

<p>which generates the following configuration file. Users can then manually
adjust the configuration file.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s">0.0.2</span>
<span class="s">pipeline_name</span><span class="pi">:</span> <span class="s">graphpred</span>
<span class="s">pipeline_mode</span><span class="pi">:</span> <span class="s">train</span>
<span class="s">device</span><span class="pi">:</span> <span class="s">cpu</span>                     <span class="c1"># Torch device name, e.g., cpu or cuda or cuda:0</span>
<span class="s">data</span><span class="pi">:</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">ogbg-molpcba</span>
    <span class="s">split_ratio</span><span class="pi">:</span>                <span class="c1"># Ratio to generate data split, for example set to [0.8, 0.1, 0.1] for 80% train/10% val/10% test. Leave blank to use builtin split in original dataset</span>
<span class="s">model</span><span class="pi">:</span>
     <span class="s">name</span><span class="pi">:</span> <span class="s">gin</span>
     <span class="s">embed_size</span><span class="pi">:</span> <span class="s">300</span>            <span class="c1"># Embedding size</span>
     <span class="s">num_layers</span><span class="pi">:</span> <span class="s">5</span>              <span class="c1"># Number of layers</span>
     <span class="s">dropout</span><span class="pi">:</span> <span class="s">0.5</span>               <span class="c1"># Dropout rate</span>
     <span class="s">virtual_node</span><span class="pi">:</span> <span class="s">false</span>        <span class="c1"># Whether to use virtual node</span>
<span class="s">general_pipeline</span><span class="pi">:</span>
    <span class="s">num_runs</span><span class="pi">:</span> <span class="s">1</span>                 <span class="c1"># Number of experiments to run</span>
    <span class="s">train_batch_size</span><span class="pi">:</span> <span class="s">32</span>        <span class="c1"># Graph batch size when training</span>
    <span class="s">eval_batch_size</span><span class="pi">:</span> <span class="s">32</span>         <span class="c1"># Graph batch size when evaluating</span>
    <span class="s">num_workers</span><span class="pi">:</span> <span class="s">4</span>              <span class="c1"># Number of workers for data loading</span>
    <span class="s">optimizer</span><span class="pi">:</span>
        <span class="s">name</span><span class="pi">:</span> <span class="s">Adam</span>
        <span class="s">lr</span><span class="pi">:</span> <span class="s">0.001</span>
        <span class="s">weight_decay</span><span class="pi">:</span> <span class="s">0</span>
    <span class="s">lr_scheduler</span><span class="pi">:</span>
        <span class="s">name</span><span class="pi">:</span> <span class="s">StepLR</span>
        <span class="s">step_size</span><span class="pi">:</span> <span class="s">100</span>
        <span class="s">gamma</span><span class="pi">:</span> <span class="s">1</span>
    <span class="s">loss</span><span class="pi">:</span> <span class="s">BCEWithLogitsLoss</span>
    <span class="s">metric</span><span class="pi">:</span> <span class="s">roc_auc_score</span>
    <span class="s">num_epochs</span><span class="pi">:</span> <span class="s">100</span>             <span class="c1"># Number of training epochs</span>
    <span class="s">save_path</span><span class="pi">:</span> <span class="s">results</span>          <span class="c1"># Directory to save the experiment results</span>
</code></pre>
</div>

<p>Alternatively, users can fetch model recipes of pre-defined hyperparameters for
the original experiments.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>dgl recipe get graphpred_pcba_gin.yaml
</code></pre>
</div>

<p>To launch training:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>dgl train --cfg graphpred_ogbg-molpcba_gin.yaml
</code></pre>
</div>

<p>Another addition is a new command to conduct inference of a trained model on
some other dataset. For example, the following shows how to apply the GIN model
trained on ogbg-molpcba to ogbg-molhiv:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># Generate an inference configuration file from a saved experiment checkpoint</span>
dgl configure-apply graphpred --data ogbg-molhiv --cpt results/run_0.pth

<span class="c"># Apply the trained model for inference</span>
dgl apply --cfg apply_graphpred_ogbg-molhiv_pna.yaml
</code></pre>
</div>

<p>It will save the model prediction in a CSV file like below</p>

<p><img src="/assets/images/posts/2022-07-25-release/csv_result.png" alt="csv_result" width="800x" class="aligncenter" /></p>

<h2 id="further-reading">Further Reading</h2>

<p>Full release note: <a href="https://github.com/dmlc/dgl/releases/tag/0.9.0">https://github.com/dmlc/dgl/releases/tag/0.9.0</a></p>
</p>
              <div class="blog-post-date">
                <p>25 <span>July</span> </p>
              </div>
              <div class="tag-links mt-30">
                <div class="widget">
                  <div class="tagcloud">
                    <a href="/tag/blog.html" class="set-2">blog</a> <a href="/tag/news.html" class="set-1">news</a> <a href="/tag/release.html" class="set-5">release</a>
                  </div>
                </div>
                <div class="blog-data">
                  <p>By 
                  
                  <a href="https://github.com/dmlc/dgl/">DGLTeam</a>,
                   in <a href="#">release</a> </p>
                </div>
              </div>
              <!-- Leave a Comment -->
              <div id="respond">
                <div class="comment-respond pb-50">
                  <div id='discourse-comments'></div>
                  <script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://discuss.dgl.ai/',
                     discourseEmbedUrl: 'https://www.dgl.ai/release/2022/07/25/release.html' };

  (function() {
    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>

                </div>
              </div>
              <!-- End Leave a Comment -->
            </div>
          </div>
        </div>
      </div>
      <!-- End Blog Content -->
      <!-- Start Blog Sidebar -->
      <!--
      <div class="col-md-3">
        <div class="row">
          <div class="blog-sidebar">
            <div class="col-md-12 col-sm-6">
              <aside id="dwqa-categories-2" class="widget widget_categories dwqa_widget dwqa_widget_categories sidebar-list">
                <h4 class="list-title">Categories</h4>
<ul>
	
	
    
	 <li><a href="topics/AngularJS">AngularJS</a></li> 
	

</ul>



              </aside>
            </div>
            <div class="col-md-12 col-sm-6">
              <aside class="widget dwqa-widget dwqa-popular-question">
                <div class="sidebar-popular-post dwqa-popular-questions">
                  <div class="popular-questions"> 
<h2 class="widget-title">Popular Questions</h2>
<ul>

    

    
     <li><a href="/category_one/question_two">Can I Start Learning AngularJS Framework ?</a></li>
    
     <li><a href="/category_one/question_one">What is AngularJS ?</a></li>
    

    
    
     <li><a href="/category_two/question_three">How Can I Learning ReactJS Framework ?</a></li>
    
     <li><a href="/category_two/question_two">How Can I Learning ReactJS Framework ?</a></li>
    

    
    
     <li><a href="/category_three/question_three">Can I Learning EmberJS Framework ?</a></li>
    
     <li><a href="/category_three/question_two">How Can I Learning EmberJS Framework ?</a></li>
    

    
    
     <li><a href="/category_four/question_one">What is VueJS ?</a></li>
    
     <li><a href="/category_four/question_two">How Can I Learning VueJS Framework ?</a></li>
    

 </ul>
</div>
                </div>
              </aside>
            </div>
          </div>
        </div>
      </div>
      -->
      <!-- End Blog Sidebar -->
    </div>
  </div>
</section>
<!-- End Blog Area -->


    <!-- Start Footer Area -->
    <footer>
        <div class="footer-area themeix-ptb">
            <div class="container">
                <div class="row">
                    <div class="footer-wrapper">
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Follow Us</h3>
                                <div class="single-footer-text">
                                    <p>Keep track the latest news, blogs and updates of DGL by following our social media accounts.</p>
                                </div>
                                <div class="social-links">
                                    <ul>
                                        <li><a href="https://twitter.com/GraphDeep"><i class="fa fa-twitter"></i></a></li>
                                        <li class="fb-link"><a href="https://www.facebook.com/GraphDeep/"><i class="fa fa-facebook"></i></a></li>
                                        <li><a href="/feed.xml"><i class="fa fa-rss"></i></a></li>
                                        <!--<li class="gp-link"><a href="#"><i class="fa fa-google-plus"></i></a></li>-->
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Quick Links</h3>
                                <div class="footer-list">
                                    <ul>
                                        <li><a href="/pages/about.html">About us</a></li>
                                        <li><a href="/pages/start.html">Get started</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/releases">Latest updates</a></li>
                                        <li><a href="/pages/index.html">Blogs</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/">Github</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Materials</h3>
                                <div class="footer-list">
                                    <ul>
                                        <li><a href="https://docs.dgl.ai/tutorials/models/index.html">Tutorials</a></li>
                                        <li><a href="https://discuss.dgl.ai">Discuss forum</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/issues">Github issues</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/blob/master/CONTRIBUTORS.md">Contributing</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Contact Us</h3>
                                <div class="subscribe-form">
                                    <form action="https://formspree.io/f/maylbdvy" method="POST">
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Name" required>
                                        <input type="text" name="message" id="message" class="form-control" placeholder="Message" required>
                                        <input type="email" name="_replyto" id="email" class="form-control" placeholder="Email" required>
                                        <button type="submit" class="hover-bg">Submit</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Start Footer Bottom Area -->
        <!--
        <div class="footer-bottom-area themeix-pb">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="footer-bottom">
                            <div class="footer-logo">
                                <a href="#"><img src="/assets/images/footer-logo.png" alt="logo"></a>
                            </div>
                            <div class="footer-links">
                                <ul>
                                    <li><a href="#">Privacy Policy</a></li>
                                    <li><a href="#">Refund Policy</a></li>
                                    <li><a href="#">Disclaimer</a></li>
                                </ul>
                            </div>
                            <div class="copyright-text">
                                <p>All content Documenter &copy; 2017 - All rights reserved. - Proudly made with <a href="http://designingmarket.com">Designing Market</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        -->
        <!-- End Footer Bottom Area -->
        <!-- Start Scroll To Top -->
        <div class="scroll-top">
            <div class="scroll-icon">
                <i class="fa fa-angle-up"></i>
            </div>
        </div>
        <!-- End Scroll To Top -->
    </footer>
    <!-- End Footer Area -->

    <!-- jquery min -->
    <script src="/assets/js/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
    

    <!-- Bootstrap Js -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- jQuery Easing -->
    <script src="/assets/js/jquery.easing.js"></script>

    <!-- Owl Carousel Js -->
    <script src="/assets/js/owl.carousel.min.js"></script>

    <!-- Google Map -->
    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOCx7VEftKaGSK2F2p_tUKmMSdN00palo"></script> -->

    <!-- Mean Menu -->
    <script src="/assets/js/jquery.meanmenu.js"></script>

    <!-- Particles JS CDN -->
    <script src="/assets/js/particles.min.js"></script> 

    <!-- Main Js -->
    <script src="/assets/js/main.js"></script>

    <!-- MathJax Js -->
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</body>

</html>
