<head>
    <!-- meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Library for deep learning on graphs">
    <meta name="keywords" content="Software, Machine Learning, Deep Learning, Neural Network, Graph">
    <meta name="author" content="Themeix">

    <!-- Site Title -->
    <title>Deep Graph Library</title>

    <!-- favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/dgl-favicon.png">

    <!-- IView CSS -->
    <link rel="stylesheet" href="//unpkg.com/iview/dist/styles/iview.css">

    <!-- Bootstrap CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font-Awesome CSS -->
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="/assets/css/googlefont.css" rel="stylesheet"> 

    <!-- Animate CSS -->
    <link rel="stylesheet" href="/assets/css/animate.min.css">

    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
    <!--<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">-->

    <!-- Mean Menu CSS -->
    <link rel="stylesheet" href="/assets/css/meanmenu.min.css">

    <!-- Main Stylesheet -->
    <link href="/assets/css/style.css" rel="stylesheet">

    <!-- Responsive CSS -->
    <link href="/assets/css/responsive.css" rel="stylesheet">

    <!-- Minima CSS -->
    <link href="/assets/main.css" rel="stylesheet">

    <!-- Rouge Highlighter CSS -->
    <link href="/assets/css/syntax.css" rel="stylesheet">

    <link type="application/atom+xml" rel="alternate" href="https://www.dgl.ai/feed.xml" title="Deep Graph Library" />

    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132455605-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132455605-1');
</script>

    
</head>
  
<body>
    <!-- Preloader starts-->
    <div class="preloader">
        <div class="loading-center">
            <div class="loading-center-absolute">
                <div class="object object_one"></div>
                <div class="object object_two"></div>
                <div class="object object_three"></div>
            </div>
        </div>
    </div>
    <!-- Preloader ends -->
    <!-- Start Header -->
    <header>
      <!-- Start Mainmenu -->
<div class="menu-area navbar-fixed-top ">
    <div class="container">
        <div class="row">
            <div class="mainmenu-wrapper">
                <!-- Start Header Logo -->
                <div class="col-xs-12 col-md-3">
                    <div class="header-logo">
                        <a href="https://www.dgl.ai"><img src="/assets/images/logo.png" alt="logo"></a>
                    </div>
                </div>
                <!-- End Header Logo -->
                <!-- Start Navigation -->
                <div class="col-xs-12 col-md-9">
                    <div class="mainmenu">
                        <div class="navbar navbar-right">
                            <div class="navbar-header visible-xs">
                                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>
                            <div class="collapse navbar-collapse top-menu">

                           <!--  Static Dropdown Menu 

                                <nav>
                                    <ul class="nav navbar-nav">
                                        <li class="active"><a href="https://www.dgl.ai">Home<span>Get everything</span></a>
                                           <ul class="dropdown">
                                               <li><a href="index.html">Home Version 1</a></li>
                                               <li><a href="index-2.html">Home Version 2</a></li>
                                           </ul>                                                
                                        </li>
                                        <li><a href="about-us.html">About<span>Know about us</span></a></li>                                
                                        <li><a href="questions.html">Questions<span>Ask Your Question</span></a>
                                            <ul class="dropdown">
                                                <li>
                                                    <a href="questions.html"> <span><i class="fa fa-question-circle"></i></span>All Questions</a>
                                                </li>                                                       
                                                <li><a href="ask-question.html"><span><i class="fa  fa-question-circle-o"></i></span>Ask Questions</a></li>
                                                <li><a href="answers.html"><span><i class="fa fa-reply-all"></i></span>Answers</a></li>
                                                <li><a href="login.html"><span><i class="fa fa-sign-in"></i></span>Login</a></li>
                                                <li><a href="register.html"><span><i class="fa fa-registered"></i></span>Register</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="#">Pages<span>See All Pages</span></a>
                                           <ul class="dropdown">
                                               <li><a href="index-2.html">Home 2</a></li>
                                               <li><a href="blog.html">Blog</a></li>
                                               <li><a href="blog-details.html">Blog Details</a></li>
                                               <li><a href="questions.html">Questions</a></li>
                                               <li><a href="answers.html">Answers</a></li>
                                               <li><a href="updates.html">Updates</a></li>
                                               <li><a href="contact.html">Contact</a></li>
                                               <li><a href="left-sidebar.html">Left Sidebar</a></li>
                                               <li><a href="right-sidebar.html">Right Sidebar</a></li>
                                               <li><a href="login.html">login</a></li>
                                               <li><a href="register.html">Register</a></li>
                                               <li><a href="404.html">404</a></li>
                                           </ul>
                                        </li>
                                        <li><a href="blog.html">Blog<span>All Blog Posts</span></a></li>
                                        <li><a href="updates.html">Updates<span>Latest releases</span></a></li>
                                        <li><a href="contact.html">Contact<span>Let us contact</span></a></li>
                                    </ul>
                                </nav> 

                                End Static Dropdown Menu -->

                                <nav>
                                    <ul class="nav navbar-nav">
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="/pages/about.html">about
                                          <!--<span>About DGL</span>-->
                                        </a>
                                     </li>
                                    
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="/pages/start.html">Get Started
                                          <!--<span>Install</span>-->
                                        </a>
                                     </li>
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="https://docs.dgl.ai/tutorials/blitz/index.html">Tutorials
                                        </a>
                                     </li>
                                     <li>
                                        <a href="/pages/index.html">Blogs
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://docs.dgl.ai">Docs
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://discuss.dgl.ai">Forum
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://github.com/dmlc/dgl">GitHub
                                        </a>
                                     </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Navigation -->
            </div>
        </div>
    </div>
</div>
<!-- End Mainmenu -->
<!-- Start Mobile Menu Area -->
<div class="col-xs-12 visible-xs">
    <div class="mobile-menu">
        <nav>
            <ul>
                <li><a href="/index.html">Home</a></li>
                
                
                
                
                 <li>
                    <a href="/pages/about.html">about
                    </a>
                 </li>
                
                
                
                
                
                 <li>
                    <a href="/pages/start.html">Get Started
                    </a>
                 </li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <!--
                <li><a href="#">Questions</a>
                    <ul>
                        <li><a href="questions.html"> Questions</a></li>
                        <li><a href="ask-question.html">Ask Questions</a></li>
                        <li><a href="answers.html">Answers</a></li>
                        <li><a href="login.html">Login</a></li>
                        <li><a href="register.html">Register</a></li>                               
                    </ul>
                </li>
                <li><a href="#">Pages</a>
                    <ul>
                       <li><a href="blog.html">Blog</a></li>
                       <li><a href="blog-details.html">Blog Details</a></li>
                       <li><a href="questions.html">Questions</a></li>
                       <li><a href="answers.html">Answers</a></li>
                       <li><a href="updates.html">Updates</a></li>
                       <li><a href="contact.html">Contact</a></li>
                       <li><a href="left-sidebar.html">Left Sidebar</a></li>
                       <li><a href="right-sidebar.html">Right Sidebar</a></li>
                       <li><a href="login.html">login</a></li>
                       <li><a href="register.html">Register</a></li>
                       <li><a href="404.html">404</a></li>                          
                    </ul>
                </li>                       
                -->
                <li><a href="https://docs.dgl.ai/tutorials/blitz/index.html">Tutorials</a></li>
                <li><a href="/pages/index.html">Blogs</a></li>
                <li><a href="https://docs.dgl.ai">Docs</a></li>
                <li><a href="https://discuss.dgl.ai">Forum</a></li>
                <li><a href="https://github.com/dmlc/dgl">GitHub</a></li>
            </ul>
        </nav>
    </div>
</div>
<!-- End MObile Menu Area

   </header>
    <!-- End Header -->
<!-- Start Page Banner Area -->
<div class="page-banner-area">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="page-title">
          <h2>Blog Details</h2>
          <span class="sub-title"><a href="https://www.dgl.ai">Home</a> / Blog Details</span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Pages Banner Area -->

<!-- Start Blog Area -->
<section class="blog-area themeix-ptb">
  <div class="container">
    <div class="row">
      <!-- Start Blog Content -->
      <div class="col-md-12">
        <div class="blog-wrapper">

          <div class="single-blog-details">
            <div class="blog-img">
              <img src="/assets/images/posts/2024-08-10-bfloat16/title.png" alt="blog">
            </div>
            <div class="blog-content-desc">
              <h4 class="themeix-blog-h">GNN training acceleration with BFloat16 data type on CPU</h4>
              <p><p>Graph neural networks (GNN) have achieved state-of-the-art performance on
various industrial tasks. However, most GNN operations are memory-bound and
require a significant amount of RAM. To tackle this problem well known
technique to reduce tensor size by using small data type is proposed for
memory efficiency optimization of GNN training on Intel® Xeon® Scalable
processors with Bfloat16. The proposed approach could achieve outstanding
optimization on various GNN models, covering a wide range of datasets, which
speeds up the training by up to 5×.</p>

<h2 id="bfloat16-data-type">Bfloat16 data type</h2>

<p>Bfloat16 is a half-precision data type. It differs from the default float data
type only in mantissa length, which is 7 bits long compared to 23 bits.</p>

<p><img src="/assets/images/posts/2024-08-10-bfloat16/bfloat16.png" alt="bfloat16" /></p>

<p>Bfloat16 was developed by the Google Brain team and is currently used widely in
DNN and other AI applications. A lot of devices natively support bfloat16
starting from GPUs and AI accelerators and ending with CPUs. Even compilers such
as GCC, and LLVM are enabling this data type in the latest <a href="https://en.cppreference.com/w/cpp/types/floating-point">C/C++ standards</a>.
According to the Google Brain team exponent is more valuable for training and ML
operations, so such reduction of mantissa bits will preserve the accuracy of the
model and at the same time provide the same performance as other half-precision
data types. Another advantage of using bfloat16 data type is the simplicity of
conversion between bfloat16 and float.</p>

<h2 id="bfloat16-cpu-acceleration">Bfloat16 CPU acceleration</h2>

<p>Starting from the 3rd Gen Intel® Xeon® Scalable processor (codenamed Cooper Lake)
x86 CPU natively supports bfloat16. It was enabled via the Intel® Advanced Vector
Extensions-512 (Intel® AVX-512): AVX512_BF16 vector instruction set, which like
other AVX512 instructions provides basic operations: dot product and conversion
functions.
In the latest 4th Gen Intel® Xeon® Scalable processors (codename Sapphire Rapids),
the Intel® <a href="https://www.intel.com/content/www/us/en/products/docs/accelerator-engines/advanced-matrix-extensions/overview.html">AMX</a>
instruction set was introduced to further improve 16-bit and 8-bit matrix
performance. In this instruction set “tile” instructions were added, which operate
on special “tile” 2D registers. Currently, this instruction set has only tile
matrix multiply unit (TMUL) support, that can perform matrix multiplication for
bfloat16 and int8 data types.
In the next Intel Xeon generations, starting from Granite Rapids, in addition to
bfloat16, fp16 will be supported.</p>

<h2 id="bfloat16-in-dgl">Bfloat16 in DGL</h2>

<p>Recently bfloat16 support was added to DGL library (starting from <a href="https://github.com/dmlc/dgl/releases/tag/1.0.0">DGL version 1.0.0</a>
for Nvidia GPU and <a href="https://github.com/dmlc/dgl/releases/tag/1.1.0">DGL version 1.1.0</a>
for CPU), so it is possible to use it in model training and inference for both
CPU and GPU devices.
Examples of DGL API, which will help to convert the graph and the model to
bfloat16 data type:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Convert graph, model, and graph features to bfloat16</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_bfloat16</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">)</span>
</code></pre>
</div>

<p>The following example trains <a href="https://snap.stanford.edu/graphsage/">GraphSAGE</a>
with bfloat16 using the provided API:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="kn">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="kn">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">dgl</span>
<span class="kn">from</span> <span class="nn">dgl.data</span> <span class="kn">import</span> <span class="n">CiteseerGraphDataset</span>
<span class="kn">from</span> <span class="nn">dgl.nn</span> <span class="kn">import</span> <span class="n">SAGEConv</span>
<span class="kn">from</span> <span class="nn">dgl.transforms</span> <span class="kn">import</span> <span class="n">AddSelfLoop</span>


<span class="k">class</span> <span class="nc">SAGE</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
        <span class="c"># two-layer SAGE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="s">"gcn"</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SAGEConv</span><span class="p">(</span><span class="n">hid_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">,</span> <span class="s">"gcn"</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h</span>


<span class="c"># Data loading</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">AddSelfLoop</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">CiteseerGraphDataset</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>


<span class="n">g</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="nb">int</span><span class="p">()</span>
<span class="n">train_mask</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s">'train_mask'</span><span class="p">]</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s">'feat'</span><span class="p">]</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ndata</span><span class="p">[</span><span class="s">'label'</span><span class="p">]</span>


<span class="n">in_size</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hid_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">out_size</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">num_classes</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SAGE</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="n">hid_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">)</span>


<span class="c"># Convert model and graph to bfloat16</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">dgl</span><span class="o">.</span><span class="n">to_bfloat16</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">)</span>


<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>


<span class="c"># Create optimizer</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">)</span>
<span class="n">loss_fcn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>


<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">feat</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fcn</span><span class="p">(</span><span class="n">logits</span><span class="p">[</span><span class="n">train_mask</span><span class="p">],</span> <span class="n">label</span><span class="p">[</span><span class="n">train_mask</span><span class="p">])</span>


    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>


    <span class="k">print</span><span class="p">(</span><span class="s">'Epoch {} | Loss {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</code></pre>
</div>

<h2 id="experimental-results">Experimental results</h2>

<p>The most popular examples have been tested – <a href="https://arxiv.org/abs/1312.6203">GCN</a>,
<a href="https://arxiv.org/abs/1706.02216">GraphSAGE</a>. For full graph training, basic
datasets were chosen, while for the mini-batch approach datasets from <a href="https://ogb.stanford.edu/docs/nodeprop/">OGB</a>
were used, the sizes of which significantly exceed the sizes of the basic ones.
For instance, ogbn-products has around 2.5 million nodes and 61 million edges,
whereas ogbn-papers100M has 111 million nodes and 1.6 million edges. Table 1.
demonstrates accuracy which is similar for float and bfloat16 or has not been
changed significantly.</p>

<table style="text-align: center;">
   <tr>
      <th>Model</th>
      <th>Dataset</th>
      <th>Test accuracy(float)</th>
      <th>Test accuracy(bfloat16)</th>
   </tr>
   <tr>
      <td>gcn</td>
      <td>citeseer</td>
      <td>71%</td>
      <td>71%</td>
   </tr>
   <tr>
      <td>gcn</td>
      <td>cora</td>
      <td>81%</td>
      <td>81%</td>
   </tr>
   <tr>
      <td>gcn</td>
      <td>pubmed</td>
      <td>79%</td>
      <td>79%</td>
   </tr>
   <tr>
      <td>graphsage</td>
      <td>citeseer</td>
      <td>71%</td>
      <td>71%</td>
   </tr>
   <tr>
      <td>graphsage</td>
      <td>cora</td>
      <td>81%</td>
      <td>81%</td>
   </tr>
   <tr>
      <td>graphsage</td>
      <td>pubmed</td>
      <td>78%</td>
      <td>78%</td>
   </tr>
   <tr>
      <td>gcn minibatch</td>
      <td>ogbn-paper100M</td>
      <td>57%</td>
      <td>57%</td>
   </tr>
   <tr>
      <td>gcn minibatch</td>
      <td>ogbn-products</td>
      <td>78%</td>
      <td>78%</td>
   </tr>
   <tr>
      <td>graphsage minibatch</td>
      <td>ogbn-paper100M</td>
      <td>62%</td>
      <td>61%</td>
   </tr>
   <tr>
      <td>graphsage minibatch</td>
      <td>ogbn-products</td>
      <td>76%</td>
      <td>74%</td>
   </tr>
</table>

<p>The plots below show results on <a href="https://aws.amazon.com/ec2/instance-types/r6i/">AWS r6i</a>
powered by 3rd Generation Intel Xeon Scalable processors (codename Ice Lake),
which does not have native bfloat16 instruction, and results on <a href="https://aws.amazon.com/ec2/instance-types/r7iz/">AWS r7iz</a>
4th Generation Intel Xeon Scalable-based (Sapphire Rapids) instances, which has
native support for both AVX512_BF16 and AMX. In both experiments, the number of
threads is limited to 16, which is the best-known number of threads for a single
run on Intel® Xeon®.</p>

<p><img src="/assets/images/posts/2024-08-10-bfloat16/plot_1.png" alt="plot_1" width="800x" class="aligncenter" />
<img src="/assets/images/posts/2024-08-10-bfloat16/plot_2.png" alt="plot_2" width="800x" class="aligncenter" /></p>

<p>The efficiency of GNN training has been enhanced on both types of Intel® Xeon®
instances with bfloat16. Notably, for basic datasets on the AWS r6i, there was
an improvement in performance of up to 32%. Similarly, for basic datasets on the
r7iz accelerated by Intel® AMX machine, the use of bfloat16 led to an improvement
in training performance of up to 92%.
When discussing the results of <a href="https://ogb.stanford.edu/docs/nodeprop/">OGB</a>
datasets, which are notably larger in size, performance improved by up to 2.89
times on the r6i and up to 5.04 times on the r7iz. On the provided plots it was
demonstrated that all training steps experienced improvements in performance.
The most significant impact was observed in the forward pass, which was up to
12.7 times faster when utilizing bfloat16.</p>

<p><img src="/assets/images/posts/2024-08-10-bfloat16/plot_3.png" alt="plot_3" width="800x" class="aligncenter" />
<img src="/assets/images/posts/2024-08-10-bfloat16/plot_4.png" alt="plot_4" width="800x" class="aligncenter" /></p>

<h2 id="conclusion">Conclusion</h2>
<p>Using the bfloat16 data type is strongly recommended for GNN training on Sapphire
Rapids and earlier generations of Intel Xeon Scalable processors to enhance
performance. Even on Ice Lake, bfloat16 enhances the efficiency of memory-bound
operations and reduces training costs.</p>

<p>Nevertheless, certain methods within DL frameworks may not fully support or
optimally use CPU bfloat16 instructions. In such situations, we advise evaluating
both float and bfloat16 performance over a small number of epochs to determine
the optimal choice.</p>

</p>
              <div class="blog-post-date">
                <p>10 <span>August</span> </p>
              </div>
              <div class="tag-links mt-30">
                <div class="widget">
                  <div class="tagcloud">
                    <a href="/tag/blog.html" class="set-2">blog</a> <a href="/tag/news.html" class="set-1">news</a> <a href="/tag/release.html" class="set-5">release</a>
                  </div>
                </div>
                <div class="blog-data">
                  <p>By 
                  
                  <a href="https://github.com/itaraban">Ilia Taraban</a>,
                   in <a href="#">blog</a> </p>
                </div>
              </div>
              <!-- Leave a Comment -->
              <div id="respond">
                <div class="comment-respond pb-50">
                  <div id='discourse-comments'></div>
                  <script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://discuss.dgl.ai/',
                     discourseEmbedUrl: 'https://www.dgl.ai/blog/2024/08/10/bfloat16.html' };

  (function() {
    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>

                </div>
              </div>
              <!-- End Leave a Comment -->
            </div>
          </div>
        </div>
      </div>
      <!-- End Blog Content -->
      <!-- Start Blog Sidebar -->
      <!--
      <div class="col-md-3">
        <div class="row">
          <div class="blog-sidebar">
            <div class="col-md-12 col-sm-6">
              <aside id="dwqa-categories-2" class="widget widget_categories dwqa_widget dwqa_widget_categories sidebar-list">
                <h4 class="list-title">Categories</h4>
<ul>
	
	
    
	 <li><a href="topics/AngularJS">AngularJS</a></li> 
	

</ul>



              </aside>
            </div>
            <div class="col-md-12 col-sm-6">
              <aside class="widget dwqa-widget dwqa-popular-question">
                <div class="sidebar-popular-post dwqa-popular-questions">
                  <div class="popular-questions"> 
<h2 class="widget-title">Popular Questions</h2>
<ul>

    

    
     <li><a href="/category_one/question_two">Can I Start Learning AngularJS Framework ?</a></li>
    
     <li><a href="/category_one/question_one">What is AngularJS ?</a></li>
    

    
    
     <li><a href="/category_two/question_three">How Can I Learning ReactJS Framework ?</a></li>
    
     <li><a href="/category_two/question_two">How Can I Learning ReactJS Framework ?</a></li>
    

    
    
     <li><a href="/category_three/question_three">Can I Learning EmberJS Framework ?</a></li>
    
     <li><a href="/category_three/question_two">How Can I Learning EmberJS Framework ?</a></li>
    

    
    
     <li><a href="/category_four/question_one">What is VueJS ?</a></li>
    
     <li><a href="/category_four/question_two">How Can I Learning VueJS Framework ?</a></li>
    

 </ul>
</div>
                </div>
              </aside>
            </div>
          </div>
        </div>
      </div>
      -->
      <!-- End Blog Sidebar -->
    </div>
  </div>
</section>
<!-- End Blog Area -->


    <!-- Start Footer Area -->
    <footer>
        <div class="footer-area themeix-ptb">
            <div class="container">
                <div class="row">
                    <div class="footer-wrapper">
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Follow Us</h3>
                                <div class="single-footer-text">
                                    <p>Keep track the latest news, blogs and updates of DGL by following our social media accounts.</p>
                                </div>
                                <div class="social-links">
                                    <ul>
                                        <li><a href="https://twitter.com/GraphDeep"><i class="fa fa-twitter"></i></a></li>
                                        <li class="fb-link"><a href="https://www.facebook.com/GraphDeep/"><i class="fa fa-facebook"></i></a></li>
                                        <li><a href="/feed.xml"><i class="fa fa-rss"></i></a></li>
                                        <!--<li class="gp-link"><a href="#"><i class="fa fa-google-plus"></i></a></li>-->
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Quick Links</h3>
                                <div class="footer-list">
                                    <ul>
                                        <li><a href="/pages/about.html">About us</a></li>
                                        <li><a href="/pages/start.html">Get started</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/releases">Latest updates</a></li>
                                        <li><a href="/pages/index.html">Blogs</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/">Github</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Materials</h3>
                                <div class="footer-list">
                                    <ul>
                                        <li><a href="https://docs.dgl.ai/tutorials/models/index.html">Tutorials</a></li>
                                        <li><a href="https://discuss.dgl.ai">Discuss forum</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/issues">Github issues</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/blob/master/CONTRIBUTORS.md">Contributing</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Contact Us</h3>
                                <div class="subscribe-form">
                                    <form action="https://formspree.io/f/maylbdvy" method="POST">
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Name" required>
                                        <input type="text" name="message" id="message" class="form-control" placeholder="Message" required>
                                        <input type="email" name="_replyto" id="email" class="form-control" placeholder="Email" required>
                                        <button type="submit" class="hover-bg">Submit</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Start Footer Bottom Area -->
        <!--
        <div class="footer-bottom-area themeix-pb">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="footer-bottom">
                            <div class="footer-logo">
                                <a href="#"><img src="/assets/images/footer-logo.png" alt="logo"></a>
                            </div>
                            <div class="footer-links">
                                <ul>
                                    <li><a href="#">Privacy Policy</a></li>
                                    <li><a href="#">Refund Policy</a></li>
                                    <li><a href="#">Disclaimer</a></li>
                                </ul>
                            </div>
                            <div class="copyright-text">
                                <p>All content Documenter &copy; 2017 - All rights reserved. - Proudly made with <a href="http://designingmarket.com">Designing Market</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        -->
        <!-- End Footer Bottom Area -->
        <!-- Start Scroll To Top -->
        <div class="scroll-top">
            <div class="scroll-icon">
                <i class="fa fa-angle-up"></i>
            </div>
        </div>
        <!-- End Scroll To Top -->
    </footer>
    <!-- End Footer Area -->

    <!-- jquery min -->
    <script src="/assets/js/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
    

    <!-- Bootstrap Js -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- jQuery Easing -->
    <script src="/assets/js/jquery.easing.js"></script>

    <!-- Owl Carousel Js -->
    <script src="/assets/js/owl.carousel.min.js"></script>

    <!-- Google Map -->
    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOCx7VEftKaGSK2F2p_tUKmMSdN00palo"></script> -->

    <!-- Mean Menu -->
    <script src="/assets/js/jquery.meanmenu.js"></script>

    <!-- Particles JS CDN -->
    <script src="/assets/js/particles.min.js"></script> 

    <!-- Main Js -->
    <script src="/assets/js/main.js"></script>

    <!-- MathJax Js -->
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</body>

</html>
