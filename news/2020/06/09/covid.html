<head>
    <!-- meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Library for deep learning on graphs">
    <meta name="keywords" content="Software, Machine Learning, Deep Learning, Neural Network, Graph">
    <meta name="author" content="Themeix">

    <!-- Site Title -->
    <title>Deep Graph Library</title>

    <!-- favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/dgl-favicon.png">

    <!-- IView CSS -->
    <link rel="stylesheet" href="//unpkg.com/iview/dist/styles/iview.css">

    <!-- Bootstrap CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font-Awesome CSS -->
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="/assets/css/googlefont.css" rel="stylesheet"> 

    <!-- Animate CSS -->
    <link rel="stylesheet" href="/assets/css/animate.min.css">

    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
    <!--<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">-->

    <!-- Mean Menu CSS -->
    <link rel="stylesheet" href="/assets/css/meanmenu.min.css">

    <!-- Main Stylesheet -->
    <link href="/assets/css/style.css" rel="stylesheet">

    <!-- Responsive CSS -->
    <link href="/assets/css/responsive.css" rel="stylesheet">

    <!-- Minima CSS -->
    <link href="/assets/main.css" rel="stylesheet">

    <!-- Rouge Highlighter CSS -->
    <link href="/assets/css/syntax.css" rel="stylesheet">

    <link type="application/atom+xml" rel="alternate" href="https://www.dgl.ai/feed.xml" title="Deep Graph Library" />

    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132455605-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132455605-1');
</script>

    
</head>
  
<body>
    <!-- Preloader starts-->
    <div class="preloader">
        <div class="loading-center">
            <div class="loading-center-absolute">
                <div class="object object_one"></div>
                <div class="object object_two"></div>
                <div class="object object_three"></div>
            </div>
        </div>
    </div>
    <!-- Preloader ends -->
    <!-- Start Header -->
    <header>
      <!-- Start Mainmenu -->
<div class="menu-area navbar-fixed-top ">
    <div class="container">
        <div class="row">
            <div class="mainmenu-wrapper">
                <!-- Start Header Logo -->
                <div class="col-xs-12 col-md-3">
                    <div class="header-logo">
                        <a href="https://www.dgl.ai"><img src="/assets/images/logo.png" alt="logo"></a>
                    </div>
                </div>
                <!-- End Header Logo -->
                <!-- Start Navigation -->
                <div class="col-xs-12 col-md-9">
                    <div class="mainmenu">
                        <div class="navbar navbar-right">
                            <div class="navbar-header visible-xs">
                                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>
                            <div class="collapse navbar-collapse top-menu">

                           <!--  Static Dropdown Menu 

                                <nav>
                                    <ul class="nav navbar-nav">
                                        <li class="active"><a href="https://www.dgl.ai">Home<span>Get everything</span></a>
                                           <ul class="dropdown">
                                               <li><a href="index.html">Home Version 1</a></li>
                                               <li><a href="index-2.html">Home Version 2</a></li>
                                           </ul>                                                
                                        </li>
                                        <li><a href="about-us.html">About<span>Know about us</span></a></li>                                
                                        <li><a href="questions.html">Questions<span>Ask Your Question</span></a>
                                            <ul class="dropdown">
                                                <li>
                                                    <a href="questions.html"> <span><i class="fa fa-question-circle"></i></span>All Questions</a>
                                                </li>                                                       
                                                <li><a href="ask-question.html"><span><i class="fa  fa-question-circle-o"></i></span>Ask Questions</a></li>
                                                <li><a href="answers.html"><span><i class="fa fa-reply-all"></i></span>Answers</a></li>
                                                <li><a href="login.html"><span><i class="fa fa-sign-in"></i></span>Login</a></li>
                                                <li><a href="register.html"><span><i class="fa fa-registered"></i></span>Register</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="#">Pages<span>See All Pages</span></a>
                                           <ul class="dropdown">
                                               <li><a href="index-2.html">Home 2</a></li>
                                               <li><a href="blog.html">Blog</a></li>
                                               <li><a href="blog-details.html">Blog Details</a></li>
                                               <li><a href="questions.html">Questions</a></li>
                                               <li><a href="answers.html">Answers</a></li>
                                               <li><a href="updates.html">Updates</a></li>
                                               <li><a href="contact.html">Contact</a></li>
                                               <li><a href="left-sidebar.html">Left Sidebar</a></li>
                                               <li><a href="right-sidebar.html">Right Sidebar</a></li>
                                               <li><a href="login.html">login</a></li>
                                               <li><a href="register.html">Register</a></li>
                                               <li><a href="404.html">404</a></li>
                                           </ul>
                                        </li>
                                        <li><a href="blog.html">Blog<span>All Blog Posts</span></a></li>
                                        <li><a href="updates.html">Updates<span>Latest releases</span></a></li>
                                        <li><a href="contact.html">Contact<span>Let us contact</span></a></li>
                                    </ul>
                                </nav> 

                                End Static Dropdown Menu -->

                                <nav>
                                    <ul class="nav navbar-nav">
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="/pages/about.html">about
                                          <!--<span>About DGL</span>-->
                                        </a>
                                     </li>
                                    
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="/pages/start.html">Get Started
                                          <!--<span>Install</span>-->
                                        </a>
                                     </li>
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                     <li>
                                        <a href="https://docs.dgl.ai/tutorials/blitz/index.html">Tutorials
                                        </a>
                                     </li>
                                     <li>
                                        <a href="/pages/index.html">Blogs
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://docs.dgl.ai">Docs
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://discuss.dgl.ai">Forum
                                        </a>
                                     </li>
                                     <li>
                                        <a href="https://github.com/dmlc/dgl">GitHub
                                        </a>
                                     </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Navigation -->
            </div>
        </div>
    </div>
</div>
<!-- End Mainmenu -->
<!-- Start Mobile Menu Area -->
<div class="col-xs-12 visible-xs">
    <div class="mobile-menu">
        <nav>
            <ul>
                <li><a href="/index.html">Home</a></li>
                
                
                
                
                 <li>
                    <a href="/pages/about.html">about
                    </a>
                 </li>
                
                
                
                
                
                 <li>
                    <a href="/pages/start.html">Get Started
                    </a>
                 </li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <!--
                <li><a href="#">Questions</a>
                    <ul>
                        <li><a href="questions.html"> Questions</a></li>
                        <li><a href="ask-question.html">Ask Questions</a></li>
                        <li><a href="answers.html">Answers</a></li>
                        <li><a href="login.html">Login</a></li>
                        <li><a href="register.html">Register</a></li>                               
                    </ul>
                </li>
                <li><a href="#">Pages</a>
                    <ul>
                       <li><a href="blog.html">Blog</a></li>
                       <li><a href="blog-details.html">Blog Details</a></li>
                       <li><a href="questions.html">Questions</a></li>
                       <li><a href="answers.html">Answers</a></li>
                       <li><a href="updates.html">Updates</a></li>
                       <li><a href="contact.html">Contact</a></li>
                       <li><a href="left-sidebar.html">Left Sidebar</a></li>
                       <li><a href="right-sidebar.html">Right Sidebar</a></li>
                       <li><a href="login.html">login</a></li>
                       <li><a href="register.html">Register</a></li>
                       <li><a href="404.html">404</a></li>                          
                    </ul>
                </li>                       
                -->
                <li><a href="https://docs.dgl.ai/tutorials/blitz/index.html">Tutorials</a></li>
                <li><a href="/pages/index.html">Blogs</a></li>
                <li><a href="https://docs.dgl.ai">Docs</a></li>
                <li><a href="https://discuss.dgl.ai">Forum</a></li>
                <li><a href="https://github.com/dmlc/dgl">GitHub</a></li>
            </ul>
        </nav>
    </div>
</div>
<!-- End MObile Menu Area

   </header>
    <!-- End Header -->
<!-- Start Page Banner Area -->
<div class="page-banner-area">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="page-title">
          <h2>Blog Details</h2>
          <span class="sub-title"><a href="https://www.dgl.ai">Home</a> / Blog Details</span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Pages Banner Area -->

<!-- Start Blog Area -->
<section class="blog-area themeix-ptb">
  <div class="container">
    <div class="row">
      <!-- Start Blog Content -->
      <div class="col-md-12">
        <div class="blog-wrapper">

          <div class="single-blog-details">
            <div class="blog-img">
              <img src="/assets/images/posts/2020-06-09-drkg/drkg.png" alt="blog">
            </div>
            <div class="blog-content-desc">
              <h4 class="themeix-blog-h">Fighting COVID-19 with Deep Graph</h4>
              <p><p>Since December 2019, the rapid spread of COVID-19 corona-viruses worldwide has
caused more than 7 million infections and more than 400,000 deaths. The rapid
spread of COVID-19 demonstrates the dire need for quick and effective drug
discovery. Drug repurposing is a drug discovery paradigm that uses existing
drugs for new therapeutic indications. It has the advantages of significantly
reducing time and cost relative to de novo drug discovery. Drug repurposing
with knowledge graphs presents a promising strategy for COVID-19 treatment.</p>

<p>A team of AWS scientists from Amazon Shanghai AI Lab and AWS Deep Engine
Science team working along with academic collaborators from the University of
Minnesota, The Ohio State University, and Hunan University have created the
<strong>Drug Repurposing Knowledge Graph (DRKG)</strong> and a set of machine learning tools
that can be used to prioritize drugs for repurposing studies. DRKG and the ML
tools are open sourced in github to help researchers conduct drug relocation
research on COVID-19 and other diseases (such as Alzheimer’s disease).</p>

<p>DRKG is a comprehensive biological knowledge graph that relates human genes,
compounds, biological processes, drug side effects, diseases and symptoms. DRKG
includes, curates, and normalizes information from six publicly available
databases and data that were collected from recent publications related to
Covid-19. It has 97,238 entities belonging to 13 types of entities, and
5,874,261 triplets belonging to 107 types of relations.</p>

<p><img src="/assets/images/posts/2020-06-09-drkg/drkg.png" alt="drkg" width="800x" class="aligncenter" /></p>
<p>
<center>
<i>The high-level structure of DRKG. Numerals indicate the number of different
types of relationships between classes of entities; terms between parentheses
are examples of those relationships.</i>
</center>
</p>

<p>The machine learning tools use DGL-KE to learn low dimension embedding
representations of entities and relations in DRKG. The resulting embeddings are
used to predict how likely a drug can treat a disease or how likely a drug can
bind to a protein associated with the disease. <a href="https://github.com/awslabs/dgl-ke">DGL-KE</a> is a high performance,
easy-to-use, and scalable package for learning large-scale knowledge graph
embeddings developed by Amazon Shanghai AI Lab. The package is implemented on
the top of Deep Graph Library (DGL) and developers can run DGL-KE on CPU
machine, GPU machine, as well as clusters with a set of popular models,
including TransE, DistMult, ComplEx, RotatE and etc. It can train a knowledge
graph consisting of over <em>86M</em> nodes and <em>338M</em> edges in 100 minutes on an EC2
instance with 8 GPUs and 30 minutes on an EC2 cluster with 4 machines.</p>

<p><img src="/assets/images/posts/2020-06-09-drkg/dgl-ke.png" alt="dglke" width="400x" class="aligncenter" /></p>

<p>DRKG github repository provides examples on using DGL-KE to <a href="https://github.com/gnn4dr/DRKG/blob/master/embedding_analysis/Train_embeddings.ipynb">learn low
dimension embedding representations of entities and relations in
DRKG</a>
and using pre-trained knowledge graph embedding of DRKG to do <a href="https://github.com/gnn4dr/DRKG/blob/master/drug_repurpose/COVID-19_drug_repurposing.ipynb">drug
repurposing</a>.
Preliminary experimental results show that using certain machine learning tools
for COVID-19 drug discovery can identify a variety of drugs currently in
clinical trials with high ranking scores.</p>

<h2 id="use-dgl-ke-to-learn-low-dimension-embedding-representations-of-entities-and-relations-in-drkg">Use DGL-KE to Learn Low Dimension Embedding Representations of Entities and Relations in DRKG</h2>

<p>DRKG uses DGL-KE to learn knowledge graph embedding</p>

<p><em>Step 1:</em> Downloading DRKG from <a href="https://dgl-data.s3-us-west-2.amazonaws.com/dataset/DRKG/drkg.tar.gz">here</a></p>

<p><em>Step 2:</em> Load DRKG as follows.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">'../utils'</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">download_and_extract</span>
<span class="n">download_and_extract</span><span class="p">()</span>
<span class="n">drkg_file</span> <span class="o">=</span> <span class="s">'../data/drkg/drkg.tsv'</span>
</code></pre>
</div>

<p><em>Step 3:</em> DRKG data package has a drkg.tsv file containing all triplets in the
knowledge graph. Before training, We randomly divide the data set into training
set, validation set and test set according to the ratio of 0.9:0.05:0.05.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">drkg_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">)</span>
<span class="n">triples</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_triples</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="n">train_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_triples</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
<span class="n">valid_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_triples</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">train_set</span> <span class="o">=</span> <span class="n">seed</span><span class="p">[:</span><span class="n">train_cnt</span><span class="p">]</span>
<span class="n">train_set</span> <span class="o">=</span> <span class="n">train_set</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">valid_set</span> <span class="o">=</span> <span class="n">seed</span><span class="p">[</span><span class="n">train_cnt</span><span class="p">:</span><span class="n">train_cnt</span><span class="o">+</span><span class="n">valid_cnt</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="n">seed</span><span class="p">[</span><span class="n">train_cnt</span><span class="o">+</span><span class="n">valid_cnt</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"train/drkg_train.tsv"</span><span class="p">,</span> <span class="s">'w+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">train_set</span><span class="p">:</span>
       <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s">"{}</span><span class="se">\t</span><span class="s">{}</span><span class="se">\t</span><span class="s">{}</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
      
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"train/drkg_valid.tsv"</span><span class="p">,</span> <span class="s">'w+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">valid_set</span><span class="p">:</span>
       <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s">"{}</span><span class="se">\t</span><span class="s">{}</span><span class="se">\t</span><span class="s">{}</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"train/drkg_test.tsv"</span><span class="p">,</span> <span class="s">'w+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">test_set</span><span class="p">:</span>
       <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s">"{}</span><span class="se">\t</span><span class="s">{}</span><span class="se">\t</span><span class="s">{}</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">triples</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
</code></pre>
</div>

<p><em>Step 4:</em> Then we directly invoke the command line toolkit provided by DGL-KE
to learn low dimension embedding representations of entities and relations in
DRKG. Here we choose the <code class="highlighter-rouge">TransE_l2</code> model and use an AWS p3.16xlarge instance to
train the model with multi-GPU in parallel. To use other KGE model or AWS
instances please refer to DGL-KE’s <a href="https://aws-dglke.readthedocs.io/en/latest/index.html">documentation</a>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">DGLBACKEND</span><span class="o">=</span>pytorch dglke_train --dataset DRKG --data_path ./train <span class="se">\</span>
                               --data_files drkg_train.tsv drkg_valid.tsv drkg_test.tsv <span class="se">\</span>
                               --format <span class="s1">'raw_udd_hrt'</span> --model_name TransE_l2 --batch_size 2048 <span class="se">\</span>
                               --neg_sample_size 256 --hidden_dim 400 --gamma 12.0 --lr 0.1 <span class="se">\</span>
                               --max_step 100000 --log_interval 1000 --batch_size_eval 16 -adv <span class="se">\</span>
                               --regularization_coef 1.00E-07 --test --num_thread 1 <span class="se">\</span>
                               --gpu 0 1 2 3 4 5 6 7 --num_proc 8 <span class="se">\</span>
                               --neg_sample_size_eval 10000 --async_update
</code></pre>
</div>

<p><em>Step 5:</em> After training, two files are generated: 1)
<code class="highlighter-rouge">DRKG_TransE_l2_entity.npy</code>, containing the low dimension embedding
representations of entities in DRKG and 2) <code class="highlighter-rouge">DRKG_TransE_l2_relation.npy</code>,
containing the low dimension embeddings representations of relations in DRKG.
These embeddings can be used in drug repurposing tasks.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">node_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'./ckpts/TransE_l2_DRKG_0/DRKG_TransE_l2_entity.npy'</span><span class="p">)</span>
<span class="n">relation_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'./ckpts/TransE_l2_DRKG_0/DRKG_TransE_l2_relation.npy'</span><span class="p">)</span>
</code></pre>
</div>

<p>The complete example code can be found <a href="https://github.com/gnn4dr/DRKG/blob/master/embedding_analysis/Train_embeddings.ipynb">here</a>.</p>

<p>Use Pre-trained Knowledge Graph Embedding for Repurposing Drugs for COVID-19
— A collaboration work from Amazon AWS AI, Hunan University, Cleveland Clinic
Lerner Center for Genomic Medicine, and University of Minnesota (Repurpose Open
Data to Discover Therapeutics for COVID-19 using Deep Learning) proposed a new
drug repurposing methodology for COVID-19 using the combination of knowledge
graph embedding and gene-set enrichment analysis method. DRKG borrows the
similar idea and provides pre-trained knowledge graph embedding of DRKG for
drug repurposing for COVID-19.</p>

<p>First of all, we define the task of finding drugs for COVID-19 using DRKG
knowledge graph as a task of predicting the possible connections between
candidate drug entities and the COVID-19 related disease entities under the
relation of <code class="highlighter-rouge">'Hetionet::CtD::Compound:Disease'</code> and <code class="highlighter-rouge">'GNBR::T::Compound:Disease'</code>,
i.e. the treatment relationship. We select FDA approved drugs with molecular
weight larger than 250 from DRKG as drug candidates and use 34 COVID-19 virus
related entities in DRKG as target entities. Then we predict the connection
scores of all possible triplets (Drug, Treatment, Virus) under the <code class="highlighter-rouge">TransE_L2</code>
algorithm and sort the scores. Finally, we choose the top100 highest confident
connections and take the corresponding drugs as repurposed drugs. The detailed
steps are as following:</p>

<p><em>Step 1:</em> Setting target virus entities, drug entities and treatment relations.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># COVID-19 related virus entities</span>
<span class="n">COV_disease_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Disease::SARS-CoV2 E'</span><span class="p">,</span><span class="s">'Disease::SARS-CoV2 M'</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

<span class="c"># treatment relations</span>
<span class="n">treatment</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Hetionet::CtD::Compound:Disease'</span><span class="p">,</span><span class="s">'GNBR::T::Compound:Disease'</span><span class="p">]</span>

<span class="c"># candidate drugs（provided in infer_drug.tsv along with the whole DRKG dataset)</span>
<span class="n">drug_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"./infer_drug.tsv"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
   <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="p">[</span><span class="s">'drug'</span><span class="p">,</span><span class="s">'ids'</span><span class="p">])</span>
   <span class="k">for</span> <span class="n">row_val</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
       <span class="n">drug_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_val</span><span class="p">[</span><span class="s">'drug'</span><span class="p">])</span>
</code></pre>
</div>

<p><em>Step 2:</em> Get the pretrained DRKG knowledge graph embedding.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Reading pretrained embeddings</span>
<span class="n">entity_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'../data/drkg/embed/DRKG_TransE_l2_entity.npy'</span><span class="p">)</span>
<span class="n">rel_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'../data/drkg/embed/DRKG_TransE_l2_relation.npy'</span><span class="p">)</span>

<span class="n">drug_ids</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">drug_ids</span><span class="p">)</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>
<span class="n">disease_ids</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">disease_ids</span><span class="p">)</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>
<span class="n">treatment_rid</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">treatment_rid</span><span class="p">)</span>

<span class="n">drug_emb</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">entity_emb</span><span class="p">[</span><span class="n">drug_ids</span><span class="p">])</span>
<span class="n">treatment_embs</span> <span class="o">=</span> <span class="p">[</span><span class="n">th</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">rel_emb</span><span class="p">[</span><span class="n">rid</span><span class="p">])</span> <span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">treatment_rid</span><span class="p">]</span>
</code></pre>
</div>

<p><em>Step 3:</em> Predict the connection scores of all possible triplets (Drug, Treatment, Virus) under the <code class="highlighter-rouge">TransE_L2</code> algorithm，the formula is as following:</p>

<script type="math/tex; mode=display">\mathbf{d} = \gamma - ||\mathbf{h} + \mathbf{r} - \mathbf{t}||_2</script>

<script type="math/tex; mode=display">\mathbf{score} = \log\left(\frac{1}{1+e^{-\mathbf{d}}}\right)</script>

<p>, where <script type="math/tex">\mathbf{h}</script> is for head (i.e., drugs), <script type="math/tex">\mathbf{r}</script> for relation, <script type="math/tex">\mathbf{t}</script> for tail
(i.e., virus) and <script type="math/tex">\gamma</script> is the constant value used in training.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="kn">as</span> <span class="nn">fn</span>

<span class="n">gamma</span><span class="o">=</span><span class="mf">12.0</span>
<span class="k">def</span> <span class="nf">transE_l2</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">tail</span><span class="p">):</span>
   <span class="n">score</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">tail</span>
   <span class="k">return</span> <span class="n">gamma</span> <span class="o">-</span> <span class="n">th</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">scores_per_disease</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c"># predict the connection scores of (Drug, Treatment, Virus) triplets </span>
<span class="c"># for each treatment type and combine them together.</span>
<span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">treatment_embs</span><span class="p">)):</span>
   <span class="n">treatment_emb</span><span class="o">=</span><span class="n">treatment_embs</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span>
   <span class="k">for</span> <span class="n">disease_id</span> <span class="ow">in</span> <span class="n">disease_ids</span><span class="p">:</span>
       <span class="n">disease_emb</span> <span class="o">=</span> <span class="n">entity_emb</span><span class="p">[</span><span class="n">disease_id</span><span class="p">]</span>
       <span class="n">score</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">logsigmoid</span><span class="p">(</span><span class="n">transE_l2</span><span class="p">(</span><span class="n">drug_emb</span><span class="p">,</span> <span class="n">treatment_emb</span><span class="p">,</span> <span class="n">disease_emb</span><span class="p">))</span>
       <span class="n">scores_per_disease</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
       <span class="n">dids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drug_ids</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">scores_per_disease</span><span class="p">)</span>
</code></pre>
</div>

<p><em>Step 4:</em> Sort the scores.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">idx</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">th</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">dids</span> <span class="o">=</span> <span class="n">dids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre>
</div>

<p><em>Step 5:</em> Get the top-100 repurposed drugs.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">topk</span><span class="o">=</span><span class="mi">100</span>
<span class="n">_</span><span class="p">,</span> <span class="n">unique_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dids</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">topk_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_indices</span><span class="p">)[:</span><span class="n">topk</span><span class="p">]</span>
<span class="c"># top-100 drug Ids</span>
<span class="n">proposed_dids</span> <span class="o">=</span> <span class="n">dids</span><span class="p">[</span><span class="n">topk_indices</span><span class="p">]</span>
<span class="c"># top-100 drug scores</span>
<span class="n">proposed_scores</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">topk_indices</span><span class="p">]</span>
</code></pre>
</div>

<p><em>Step 6:</em> Six drugs in clinical trials appears in the top100 repurposed drugs. Their ranking and score is as following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[0]    Ribavirin          -0.21416784822940826
[4]    Dexamethasone      -0.9984006881713867
[8]    Colchicine         -1.080674648284912
[16]   Methylprednisolone -1.1618402004241943
[49]   Oseltamivir        -1.3885014057159424
[87]   Deferoxamine       -1.513066053390503
</code></pre>
</div>

<p>The complete example code can be found <a href="https://github.com/gnn4dr/DRKG/blob/master/drug_repurpose/COVID-19_drug_repurposing.ipynb">here</a>.</p>

<h2 id="further-read">Further read</h2>

<ul>
  <li>Check out the <a href="https://github.com/gnn4dr/DRKG">DRKG repository</a>.</li>
  <li>Check out the <a href="https://www.amazon.science/blog/amazon-web-services-open-sources-biological-knowledge-graph-to-fight-covid-19">announcement</a> on Amazon Science.</li>
  <li><a href="https://zhuanlan.zhihu.com/p/147329945">Blog in chinese</a>.</li>
</ul>
</p>
              <div class="blog-post-date">
                <p>09 <span>June</span> </p>
              </div>
              <div class="tag-links mt-30">
                <div class="widget">
                  <div class="tagcloud">
                    <a href="/tag/blog.html" class="set-3">blog</a> <a href="/tag/news.html" class="set-2">news</a> <a href="/tag/release.html" class="set-5">release</a>
                  </div>
                </div>
                <div class="blog-data">
                  <p>By 
                  
                  <a href="https://github.com/dmlc/dgl/">DGLTeam</a>,
                   in <a href="#">news</a> </p>
                </div>
              </div>
              <!-- Leave a Comment -->
              <div id="respond">
                <div class="comment-respond pb-50">
                  <div id='discourse-comments'></div>
                  <script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://discuss.dgl.ai/',
                     discourseEmbedUrl: 'https://www.dgl.ai/news/2020/06/09/covid.html' };

  (function() {
    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>

                </div>
              </div>
              <!-- End Leave a Comment -->
            </div>
          </div>
        </div>
      </div>
      <!-- End Blog Content -->
      <!-- Start Blog Sidebar -->
      <!--
      <div class="col-md-3">
        <div class="row">
          <div class="blog-sidebar">
            <div class="col-md-12 col-sm-6">
              <aside id="dwqa-categories-2" class="widget widget_categories dwqa_widget dwqa_widget_categories sidebar-list">
                <h4 class="list-title">Categories</h4>
<ul>
	
	
    
	 <li><a href="topics/AngularJS">AngularJS</a></li> 
	

</ul>



              </aside>
            </div>
            <div class="col-md-12 col-sm-6">
              <aside class="widget dwqa-widget dwqa-popular-question">
                <div class="sidebar-popular-post dwqa-popular-questions">
                  <div class="popular-questions"> 
<h2 class="widget-title">Popular Questions</h2>
<ul>

    

    
     <li><a href="/category_one/question_two">Can I Start Learning AngularJS Framework ?</a></li>
    
     <li><a href="/category_one/question_one">What is AngularJS ?</a></li>
    

    
    
     <li><a href="/category_two/question_three">How Can I Learning ReactJS Framework ?</a></li>
    
     <li><a href="/category_two/question_two">How Can I Learning ReactJS Framework ?</a></li>
    

    
    
     <li><a href="/category_three/question_three">Can I Learning EmberJS Framework ?</a></li>
    
     <li><a href="/category_three/question_two">How Can I Learning EmberJS Framework ?</a></li>
    

    
    
     <li><a href="/category_four/question_one">What is VueJS ?</a></li>
    
     <li><a href="/category_four/question_two">How Can I Learning VueJS Framework ?</a></li>
    

 </ul>
</div>
                </div>
              </aside>
            </div>
          </div>
        </div>
      </div>
      -->
      <!-- End Blog Sidebar -->
    </div>
  </div>
</section>
<!-- End Blog Area -->


    <!-- Start Footer Area -->
    <footer>
        <div class="footer-area themeix-ptb">
            <div class="container">
                <div class="row">
                    <div class="footer-wrapper">
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Follow Us</h3>
                                <div class="single-footer-text">
                                    <p>Keep track the latest news, blogs and updates of DGL by following our social media accounts.</p>
                                </div>
                                <div class="social-links">
                                    <ul>
                                        <li><a href="https://twitter.com/GraphDeep"><i class="fa fa-twitter"></i></a></li>
                                        <li class="fb-link"><a href="https://www.facebook.com/GraphDeep/"><i class="fa fa-facebook"></i></a></li>
                                        <li><a href="/feed.xml"><i class="fa fa-rss"></i></a></li>
                                        <!--<li class="gp-link"><a href="#"><i class="fa fa-google-plus"></i></a></li>-->
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Quick Links</h3>
                                <div class="footer-list">
                                    <ul>
                                        <li><a href="/pages/about.html">About us</a></li>
                                        <li><a href="/pages/start.html">Get started</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/releases">Latest updates</a></li>
                                        <li><a href="/pages/index.html">Blogs</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/">Github</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Materials</h3>
                                <div class="footer-list">
                                    <ul>
                                        <li><a href="https://docs.dgl.ai/tutorials/models/index.html">Tutorials</a></li>
                                        <li><a href="https://discuss.dgl.ai">Discuss forum</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/issues">Github issues</a></li>
                                        <li><a href="https://github.com/dmlc/dgl/blob/master/CONTRIBUTORS.md">Contributing</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="single-footer">
                                <h3 class="footer-heading">Contact Us</h3>
                                <div class="subscribe-form">
                                    <form action="https://formspree.io/f/maylbdvy" method="POST">
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Name" required>
                                        <input type="text" name="message" id="message" class="form-control" placeholder="Message" required>
                                        <input type="email" name="_replyto" id="email" class="form-control" placeholder="Email" required>
                                        <button type="submit" class="hover-bg">Submit</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Start Footer Bottom Area -->
        <!--
        <div class="footer-bottom-area themeix-pb">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="footer-bottom">
                            <div class="footer-logo">
                                <a href="#"><img src="/assets/images/footer-logo.png" alt="logo"></a>
                            </div>
                            <div class="footer-links">
                                <ul>
                                    <li><a href="#">Privacy Policy</a></li>
                                    <li><a href="#">Refund Policy</a></li>
                                    <li><a href="#">Disclaimer</a></li>
                                </ul>
                            </div>
                            <div class="copyright-text">
                                <p>All content Documenter &copy; 2017 - All rights reserved. - Proudly made with <a href="http://designingmarket.com">Designing Market</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        -->
        <!-- End Footer Bottom Area -->
        <!-- Start Scroll To Top -->
        <div class="scroll-top">
            <div class="scroll-icon">
                <i class="fa fa-angle-up"></i>
            </div>
        </div>
        <!-- End Scroll To Top -->
    </footer>
    <!-- End Footer Area -->

    <!-- jquery min -->
    <script src="/assets/js/jquery.min.js"></script>

    <!-- Bootstrap Js -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- jQuery Easing -->
    <script src="/assets/js/jquery.easing.js"></script>

    <!-- Owl Carousel Js -->
    <script src="/assets/js/owl.carousel.min.js"></script>

    <!-- Google Map -->
    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOCx7VEftKaGSK2F2p_tUKmMSdN00palo"></script> -->

    <!-- Mean Menu -->
    <script src="/assets/js/jquery.meanmenu.js"></script>

    <!-- Particles JS CDN -->
    <script src="/assets/js/particles.min.js"></script> 

    <!-- Main Js -->
    <script src="/assets/js/main.js"></script>

    <!-- MathJax Js -->
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</body>

</html>
